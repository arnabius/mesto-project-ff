(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"b8b29966-7d93-4632-8883-010a6bd8e2e6","Content-Type":"application/json"}};function t(e,t){e?(t.oldTextContent=t.textContent,t.textContent="Сохранение..."):t.textContent=t.oldTextContent}var n=document.querySelector("#card-template").content;function o(e,t,o,r,a){var i=n.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__image"),s=i.querySelector(".card__title");u.src=e.link,u.alt=e.name,s.textContent=e.name,i._id=e._id,i.owner_id=e.owner._id;var l=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button");return a._id===i.owner_id?(l.addEventListener("click",(function(){t(l)})),l.classList.remove("card__button-hidden")):l.classList.add("card__button-hidden"),d.addEventListener("click",r),e.likes.some((function(e){return e._id===a._id}))&&function(e){e.querySelector(".card__like-button").classList.add("card__like-button_is-active")}(i),c(i,e.likes.length),u.addEventListener("click",(function(){o(e.link,e.name)})),i}function r(t){var n,o=t.closest(".card");(n=o._id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления карточки: ".concat(e.status))}))).then((function(e){o.remove()})).catch((function(e){console.log(e)}))}function c(e,t){var n=e.querySelector(".card__like-quantity"),o=e.querySelector(".card__description");t>0?(o.classList.add("card__description-liked"),n.textContent=t):(o.classList.remove("card__description-liked"),n.textContent="")}function a(t){var n=t.target.closest(".card"),o=!t.target.classList.contains("card__like-button_is-active");(function(t,n){var o=!0===n?"PUT":"DELETE";return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:o,headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка постановки/удаления лайка: ".concat(e.status))}))})(n._id,o).then((function(e){!function(e){e.querySelector(".card__like-button").classList.toggle("card__like-button_is-active")}(n),c(n,e.likes.length)})).catch((function(e){console.log(e)}))}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)}function s(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}var l=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_submit_inactive")):(t.disabled=!0,t.classList.add("popup__button_submit_inactive"))},d=function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),console.log(t),console.log(t.validity),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__input-error_active")}(e,t,t.validationMessage)};function p(e,t){var n=Array.from(e.querySelector(".popup__input"));e.querySelector(".popup__button"),n.forEach((function(t){d(e,t)}))}fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения данных профиля: ".concat(e.status))})).then((function(e){T(e)})).catch((function(e){console.log(e)}));var _=document.querySelector(".places__list");fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения массива карточек: ".concat(e.status))})).then((function(e){Array.from(e).forEach((function(e){var t=o(e,r,N,a,A);_.append(t)}))})).catch((function(e){console.log(e)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&u(e)}))}));var f=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_new-card"),m=y.querySelector(".popup__form"),v=m.querySelector(".popup__input_type_card-name"),h=m.querySelector(".popup__input_type_url");f.addEventListener("click",(function(e){m.reset(),i(y)})),m.addEventListener("submit",(function(n){n.preventDefault();var c,i,s=n.target.querySelector(".popup__button");t(!0,s),(c=v.value,i=h.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка добавления карточки: ".concat(e.status))}))).then((function(e){var t=o(e,r,N,a,A);_.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){t(!1,s)})),u(y)}));var S=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),q=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),L=b.querySelector(".popup__form"),g=L.querySelector(".popup__input_type_name"),E=L.querySelector(".popup__input_type_description"),C=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_edit-avatar"),x=j.querySelector(".popup__form"),P=x.querySelector(".popup__input_type_url"),A={};function T(e){q.textContent=e.name,k.textContent=e.about,C.style.backgroundImage="url(".concat(e.avatar,")"),A._id=e._id,A.name=e.name,A.about=e.about,A.avatar=e.avatar}S.addEventListener("click",(function(){g.value=q.textContent,E.value=k.textContent,i(b),p(L)})),L.addEventListener("submit",(function(n){n.preventDefault();var o=n.target.querySelector(".popup__button");t(!0,o);var r,c,a=g.value,i=E.value;u(b),(r=a,c=i,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка сохранения данных профиля: ".concat(e.status))}))).then((function(e){T(e)})).catch((function(e){console.log(e)})).finally((function(){t(!1,o)}))})),C.addEventListener("click",(function(){i(j),p(x)})),x.addEventListener("submit",(function(n){n.preventDefault();var o,r=P.value,c=n.target.querySelector(".popup__button");t(!0,c),u(j),(o=r,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка сохранения аватара профиля: ".concat(e.status))}))).then((function(e){T(e)})).catch((function(e){console.log(e)})).finally((function(){t(!1,c)}))}));var U=document.querySelector(".popup_type_image"),w=U.querySelector(".popup__image"),D=U.querySelector(".popup__caption");function N(e,t){w.src=e,w.alt=t,D.textContent=t,i(U)}Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach((function(o){l(t,n),o.addEventListener("input",(function(){l(t,n),d(e,o)}))}))}(e)}))})();